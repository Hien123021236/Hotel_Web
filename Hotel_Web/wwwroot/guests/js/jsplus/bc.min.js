window.PciFrameManager||(window.PciFrameManager={cardTypeList:["visaelectron","maestro","forbrugsforeningen","dankort","visa","mastercard","amex","dinersclub","discover","unionpay","jcb"],translations:null,parent:null,cardNumberField:null,acceptedChars:"[�����������������������ܟǌ��������A-Z]",acceptedExtraChars:"[����� ������ ����� ��� ����ܟ ǌ ��� ��� �� A-Z 0-9 '.-]",charRegEx:null,onlyLatinChars:1,currentCardtype:"",force:!1,setCardTypes:function(n){var t,i;return $.inArray("visa",n)&&n.push("visaelectron"),t=$("#credit_cards img"),t.removeClass("to-remove"),t.addClass("to-remove"),i=$("#credit_cards0 img"),i.removeClass("to-remove"),i.addClass("to-remove"),$.each(n,function(t,i){if(i){n[t]=i.toLowerCase();switch(n[t]){case"cirrus/maestro":n[t]="maestro";break;case"diners":n[t]="dinersclub"}$("#credit_cards img."+n[t]).removeClass("to-remove");$("#credit_cards0 img."+n[t]).removeClass("to-remove")}}),$("#credit_cards img.to-remove").remove(),$("#credit_cards0 img.to-remove").remove(),PciFrameManager.cardTypeList=n,!0},setTranslations:function(n){if(PciFrameManager.translations=n,PciFrameManager.onlyLatinChars=null!==PciFrameManager.translations.onlyLatinChars?PciFrameManager.translations.onlyLatinChars:PciFrameManager.onlyLatinChar,$("[data-key=guarantee-card-name]").text(null!==PciFrameManager.translations["guarantee-card-name"]?PciFrameManager.translations["guarantee-card-name"]:$("[data-key=guarantee-card-name]").text()),$("[data-key=guarantee-card-number]").text(null!==PciFrameManager.translations["guarantee-card-number"]?PciFrameManager.translations["guarantee-card-number"]:$("[data-key=guarantee-card-number]").text()),$("[data-key=guarantee-card-type]").text(null!==PciFrameManager.translations["guarantee-card-type"]?PciFrameManager.translations["guarantee-card-type"]:$("[data-key=guarantee-card-type]").text()),$("[data-key=guarantee-expire-date]").text(null!==PciFrameManager.translations["guarantee-expire-date"]?PciFrameManager.translations["guarantee-expire-date"]:$("[data-key=guarantee-expire-date]").text()),$("[data-key=guarantee-security-code]").text(null!==PciFrameManager.translations["guarantee-security-code"]?PciFrameManager.translations["guarantee-security-code"]:$("[data-key=guarantee-security-code]").text()),$("div.owner").children("em").text(null!==PciFrameManager.translations["validation-error-guarantee-holder"]?PciFrameManager.translations["validation-error-guarantee-holder"]:$("div.owner").children("em").eq(0).text()),PciFrameManager.onlyLatinChars==1&&$("div.owner").children("em").text(null!==PciFrameManager.translations["validation-error-guarantee-holder-onlylatin"]?PciFrameManager.translations["validation-error-guarantee-holderonlylatin"]:$("div.owner").children("em").eq(0).text()),$("div.ccNumber").children("em").text(null!==PciFrameManager.translations["validation-error-guarantee-number"]?PciFrameManager.translations["validation-error-guarantee-number"]:$("div.ccNumber").children("em").text()),$("div.cvv").children("em").text(null!==PciFrameManager.translations["validation-error-guarantee-cvv"]?PciFrameManager.translations["validation-error-guarantee-cvv"]:$("div.cvv").children("em").text()),$("div.expirationDate").children("em").text(null!==PciFrameManager.translations["validation-error-guarantee-expire"]?PciFrameManager.translations["validation-error-guarantee-expire"]:$("div.expirationDate").children("em").text()),$("div.expirationMonth").children("em").text(null!==PciFrameManager.translations["validation-error-guarantee-month"]?PciFrameManager.translations["validation-error-guarantee-month"]:$("div.expirationMonth").children("em").text()),$("div.expirationYear").children("em").text(null!==PciFrameManager.translations["validation-error-guarantee-year"]?PciFrameManager.translations["validation-error-guarantee-year"]:$("div.expirationYear").children("em").text()),null!==PciFrameManager.translations.months.names)for(var t=1;t<=12;t++)$("#cc-exp-month option").eq(t).text(PciFrameManager.translations.months.names[t-1]);return!0},init:function(){var n="cardTypeList",t="get";$("#cc-name").val("");$("#cc-number").val("");$("#cc-exp-month").val("");$("#cc-exp-year").val("");$("#cvv").val("");$("#token").val("");PciFrameManager.parent.send({method:"set",name:"cc-name",value:""});PciFrameManager.parent.send({method:"set",name:"cc-number",value:""});PciFrameManager.parent.send({method:"set",name:"cc-exp-month",value:""});PciFrameManager.parent.send({method:"set",name:"cc-exp-year",value:""});PciFrameManager.parent.send({method:"set",name:"cc-type",value:""});PciFrameManager.parent.send({method:"set",name:"cc-csc",value:""});PciFrameManager.parent.send({data:{key:n,method:t},success:function(i){i!==!1&&typeof i[n]!="undefined"&&(PciFrameManager.setCardTypes(i[n]),n="translations",t="get",PciFrameManager.parent.send({data:{key:n,method:t},success:function(t){t!==!1&&typeof t[n]!="undefined"&&PciFrameManager.setTranslations(t[n])}}))}})},validateField:function(n){var r;n.preventDefault();var t=n.target,u=n.type,i=!1;switch(t.id){case"cc-name":$("div.owner").children("em").eq(0).hide();$("div.owner").removeClass("has-error");$("div.owner").removeClass("has-success");u=="change"?PciFrameManager.onlyLatinChars==0||PciFrameManager.charRegEx.test(t.value)?t.value.length>=5?($("div.owner").removeClass("has-error"),$("div.owner").addClass("has-success"),PciFrameManager.parent.send({method:"set",name:t.id,value:t.value}),i=!0):($("div.owner").addClass("has-error"),$("div.owner").removeClass("has-success"),$("div.owner").children("em").eq(0).show(),PciFrameManager.parent.send({method:"set",name:t.id,value:""})):($("div.owner").addClass("has-error"),$("div.owner").removeClass("has-success"),$("div.owner").children("em").eq(0).show(),PciFrameManager.parent.send({method:"set",name:t.id,value:""})):PciFrameManager.onlyLatinChars==0||PciFrameManager.charRegEx.test(t.value)?t.value.length>=5?(PciFrameManager.parent.send({method:"set",name:t.id,value:t.value}),i=!0):PciFrameManager.parent.send({method:"set",name:t.id,value:""}):(PciFrameManager.parent.send({method:"set",name:t.id,value:""}),i=!1);break;case"cvv":i=$.payform.validateCardCVC(t.value);$("div.cvv").removeClass("has-error");$("div.cvv").removeClass("has-success");$("div.cvv").children("em").hide();u=="change"?i?($("div.cvv").removeClass("has-error"),$("div.cvv").addClass("has-success"),$("div.cvv").children("em").hide(),PciFrameManager.tryToSubmit(n)):($("div.cvv").removeClass("has-success"),$("div.cvv").addClass("has-error"),$("div.cvv").children("em").show(),$("input[id=token]").val(""),PciFrameManager.parent.send({method:"set",name:"cc-number",value:""}),PciFrameManager.parent.send({method:"set",name:"cc-csc",value:""})):i?PciFrameManager.tryToSubmit(n):($("input[id=token]").val(""),PciFrameManager.parent.send({method:"set",name:"cc-number",value:""}),PciFrameManager.parent.send({method:"set",name:"cc-csc",value:""}));break;case"cc-number":if(PciFrameManager.currentCardtype="",PciFrameManager.parent.send({method:"set",name:"cc-type",value:""}),i=$.payform.validateCardNumber(t.value),u=="change")if(i)if(r=$.payform.parseCardType(t.value),$.inArray(r,PciFrameManager.cardTypeList)>=0){$("#credit_cards img").hide();$("#credit_cards img."+r).show();$("#credit_cards0 img").hide();$("#credit_cards0 img."+r).show();switch(r){case"maestro":r="cirrus/maestro";break;case"dinersclub":r="diners";break;case"visaelectron":r="visa"}PciFrameManager.currentCardtype=r;PciFrameManager.parent.send({method:"set",name:"cc-type",value:r});PciFrameManager.cardNumberField.removeClass("has-error");PciFrameManager.cardNumberField.addClass("has-success");PciFrameManager.cardNumberField.children("em").hide();PciFrameManager.tryToSubmit(n);i=!0}else PciFrameManager.cardNumberField.addClass("has-error"),PciFrameManager.cardNumberField.removeClass("has-success"),PciFrameManager.cardNumberField.children("em").show(),PciFrameManager.parent.send({method:"set",name:"cc-number",value:""}),PciFrameManager.parent.send({method:"set",name:"cc-csc",value:""}),$("input[id=token]").val(""),i=!1;else PciFrameManager.cardNumberField.addClass("has-error"),PciFrameManager.cardNumberField.removeClass("has-success"),PciFrameManager.cardNumberField.children("em").show(),PciFrameManager.parent.send({method:"set",name:"cc-number",value:""}),PciFrameManager.parent.send({method:"set",name:"cc-csc",value:""}),$("input[id=token]").val(""),i=!1;else if(i)if(r=$.payform.parseCardType(t.value),$.inArray(r,PciFrameManager.cardTypeList)>=0){$("#credit_cards img").hide();$("#credit_cards img."+r).show();$("#credit_cards0 img").hide();$("#credit_cards0 img."+r).show();switch(r){case"maestro":r="cirrus/maestro";break;case"dinersclub":r="diners";break;case"visaelectron":r="visa"}PciFrameManager.currentCardtype=r;PciFrameManager.parent.send({method:"set",name:"cc-type",value:r});PciFrameManager.cardNumberField.removeClass("has-error");PciFrameManager.cardNumberField.addClass("has-success");PciFrameManager.cardNumberField.children("em").hide();PciFrameManager.tryToSubmit(n);i=!0}else PciFrameManager.parent.send({method:"set",name:"cc-number",value:""}),PciFrameManager.parent.send({method:"set",name:"cc-csc",value:""}),$("input[id=token]").val(""),i=!1;else PciFrameManager.parent.send({method:"set",name:"cc-number",value:""}),PciFrameManager.parent.send({method:"set",name:"cc-csc",value:""}),$("input[id=token]").val(""),i=!1;break;case"cc-exp-month":$("div.expirationDate").removeClass("has-error");$("div.expirationDate").removeClass("has-success");$("div.expirationDate").children("em").hide();$("div.expirationMonth").removeClass("has-error");$("div.expirationMonth").removeClass("has-success");$("div.expirationMonth").children("em").hide();$("div.expirationYear").removeClass("has-error");$("div.expirationYear").removeClass("has-success");$("div.expirationYear").children("em").hide();(!!$("#cc-exp-year").val()||PciFrameManager.force)&&(i=!!$.payform.validateCardExpiry(t.value,$("#cc-exp-year").val()),i?(PciFrameManager.parent.send({method:"set",name:"cc-exp-month",value:t.value}),PciFrameManager.parent.send({method:"set",name:"cc-exp-year",value:$("#cc-exp-year").val()}),$("div.expirationDate").removeClass("has-error"),$("div.expirationDate").addClass("has-success"),$("div.expirationDate").children("em").hide(),$("div.expirationMonth").removeClass("has-error"),$("div.expirationMonth").addClass("has-success"),$("div.expirationMonth").children("em").hide(),$("div.expirationYear").removeClass("has-error"),$("div.expirationYear").addClass("has-success"),$("div.expirationYear").children("em").hide()):(PciFrameManager.parent.send({method:"set",name:"cc-exp-month",value:""}),PciFrameManager.parent.send({method:"set",name:"cc-exp-year",value:""}),$("div.expirationDate").addClass("has-error"),$("div.expirationDate").removeClass("has-success"),$("div.expirationDate").children("em").show(),$("div.expirationYear").addClass("has-error"),$("div.expirationYear").removeClass("has-success"),$("div.expirationMonth").addClass("has-error"),$("div.expirationMonth").removeClass("has-success")));break;case"cc-exp-year":(!!$("#cc-exp-month").val()||PciFrameManager.force)&&(i=!!$.payform.validateCardExpiry($("#cc-exp-month").val(),t.value),i?(PciFrameManager.parent.send({method:"set",name:"cc-exp-month",value:$("#cc-exp-month").val()}),PciFrameManager.parent.send({method:"set",name:"cc-exp-year",value:t.value}),$("div.expirationDate").removeClass("has-error"),$("div.expirationDate").addClass("has-success"),$("div.expirationDate").children("em").hide(),$("div.expirationMonth").removeClass("has-error"),$("div.expirationMonth").addClass("has-success"),$("div.expirationMonth").children("em").hide(),$("div.expirationYear").removeClass("has-error"),$("div.expirationYear").addClass("has-success"),$("div.expirationYear").children("em").hide()):(PciFrameManager.parent.send({method:"set",name:"cc-exp-month",value:""}),PciFrameManager.parent.send({method:"set",name:"cc-exp-year",value:""}),$("div.expirationDate").addClass("has-error"),$("div.expirationDate").removeClass("has-success"),$("div.expirationDate").children("em").show(),$("div.expirationYear").addClass("has-error"),$("div.expirationYear").removeClass("has-success"),$("div.expirationMonth").addClass("has-error"),$("div.expirationMonth").removeClass("has-success")))}return i},getToken:function(n){var f=n.target,u=n.type,i;if($("input[id=token]").val()===""){PciFrameManager.parent.send({method:"set",name:"cc-number",value:""});PciFrameManager.parent.send({method:"set",name:"cc-csc",value:""});var r=$("input[name=__RequestVerificationToken]").val(),t={ccNumber:$("#cc-number").val().replace(/ /g,""),cvv:$("#cvv").val().replace(/ /g,"")};typeof t=="object"&&(t=JSON.stringify(t));u=="change"&&(PciFrameManager.cardNumberField.addClass("has-error"),PciFrameManager.cardNumberField.removeClass("has-success"),PciFrameManager.cardNumberField.children("em").show(),$("div.cvv").addClass("has-error"),$("div.cvv").removeClass("has-success"),$("div.cvv").children("em").show());i={url:"/api/Tokenize",type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:t,success:function(n){$("input[id=token]").val(n.ccNumber);PciFrameManager.parent.send({method:"set",name:"cc-number",value:n.ccNumber});PciFrameManager.parent.send({method:"set",name:"cc-csc",value:"000"});PciFrameManager.cardNumberField.removeClass("has-error");PciFrameManager.cardNumberField.addClass("has-success");PciFrameManager.cardNumberField.children("em").hide();$("div.cvv").removeClass("has-error");$("div.cvv").addClass("has-success");$("div.cvv").children("em").hide()}};r&&(i.headers={RequestVerificationToken:r});$.ajax(i)}},tryToSubmit:function(n){var t=3,r=n.target,i=n.type;$.payform.validateCardNumber($("#cc-number").val())&&$.payform.validateCardCVC($("#cvv").val())?(PciFrameManager.currentCardtype==="amex"&&(t=4),$("#cvv").val().length===t?PciFrameManager.getToken(n):(i=="change"&&($("#cvv").val()!=""||PciFrameManager.force)&&($("div.cvv").removeClass("has-success"),$("div.cvv").addClass("has-error"),$("div.cvv").children("em").show()),$("input[id=token]").val(""),PciFrameManager.parent.send({method:"set",name:"cc-number",value:""}),PciFrameManager.parent.send({method:"set",name:"cc-csc",value:""}))):(i=="change"&&($("#cvv").val()!=""||PciFrameManager.force)&&($("div.cvv").removeClass("has-success"),$("div.cvv").addClass("has-error"),$("div.cvv").children("em").show()),$("input[id=token]").val(""),PciFrameManager.parent.send({method:"set",name:"cc-number",value:""}),PciFrameManager.parent.send({method:"set",name:"cc-csc",value:""}))},validateForm:function(){PciFrameManager.force=!0;var n=new Event("change");$("#cc-number").get(0).dispatchEvent(n);$("#cvv").get(0).dispatchEvent(n);$("#cc-name").get(0).dispatchEvent(n);$("#cc-exp-month").get(0).dispatchEvent(n);$("#cc-exp-year").get(0).dispatchEvent(n);PciFrameManager.force=!1;return},start:function(){PciFrameManager.charRegEx=new RegExp("^"+PciFrameManager.acceptedExtraChars+"*"+PciFrameManager.acceptedChars+"+"+PciFrameManager.acceptedExtraChars+"*$","i");PciFrameManager.parent=window.seamless.connect({url:window.originDomain,onConnect:PciFrameManager.init});PciFrameManager.cardNumberField=$("#card-number-field");$("#cc-number").payform("formatCardNumber");$("#cvv").payform("formatCardCVC");$("#cc-number").get(0).addEventListener("input",PciFrameManager.validateField);$("#cc-number").get(0).addEventListener("change",PciFrameManager.validateField);$("#cvv").get(0).addEventListener("input",PciFrameManager.validateField);$("#cvv").get(0).addEventListener("change",PciFrameManager.validateField);$("#cc-name").get(0).addEventListener("input",PciFrameManager.validateField);$("#cc-name").get(0).addEventListener("change",PciFrameManager.validateField);$("#cc-exp-month").get(0).addEventListener("change",PciFrameManager.validateField);$("#cc-exp-year").get(0).addEventListener("change",PciFrameManager.validateField);PciFrameManager.parent.receive(function(n){switch(n.method){case"validateForm":return PciFrameManager.validateForm()}})},errorPage:function(){PciFrameManager.parent=window.seamless.connect({url:window.originDomain,onConnect:PciFrameManager.init})}});$(document).ready(function(){PciFrameManager.start()});